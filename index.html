<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WAVEBOYS QUIZ</title>
  <style>
    :root{
      --bg:#0b1020;
      --text:#eaf0ff;
      --muted:#a9b4d6;
      --good:#27d17c;
      --bad:#ff4d4d;
      --accent:#7aa7ff;
      --border:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --gold:#ffd36e;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 700px at 20% 10%, rgba(122,167,255,.18), transparent 60%),
                  radial-gradient(900px 600px at 80% 0%, rgba(39,209,124,.10), transparent 55%),
                  radial-gradient(900px 600px at 80% 100%, rgba(255,77,77,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    header{
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      background: rgba(11,16,32,.70);
      border-bottom: 1px solid var(--border);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .topbar{
      display:flex;align-items:flex-start;justify-content:space-between;gap:14px;flex-wrap:wrap;
    }
    .madeby{
      font-weight:800;
      letter-spacing:.2px;
      padding:10px 12px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius:12px;
      box-shadow: var(--shadow);
      white-space:nowrap;
    }
    .titleblock{display:flex;flex-direction:column;gap:6px;min-width:260px;flex:1}
    h1{margin:0;font-size:20px;line-height:1.2}
    .subtitle{color:var(--muted);font-size:13px}
    .stats{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end;
      min-width:280px;
    }
    .pill{
      display:flex;align-items:center;gap:8px;
      padding:10px 12px;border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius:12px;
      box-shadow: var(--shadow);
      font-weight:700;
    }
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
    .dot.good{background:var(--good)}
    .dot.bad{background:var(--bad)}
    .dot.rem{background:var(--accent)}
    .bar{
      width:100%;
      height:12px;
      border-radius:999px;
      overflow:hidden;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      display:flex;
    }
    .seg{height:100%}
    .seg.good{background:var(--good)}
    .seg.bad{background:var(--bad)}
    .seg.rem{background:var(--accent)}

    main .wrap{padding-top:18px;padding-bottom:40px}
    .controls{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      margin-bottom:14px;
    }
    button{
      cursor:pointer;
      border:none;
      color:var(--text);
      background: linear-gradient(180deg, rgba(122,167,255,.35), rgba(122,167,255,.15));
      border:1px solid rgba(122,167,255,.35);
      padding:10px 12px;border-radius:12px;
      font-weight:800;
      box-shadow: var(--shadow);
    }
    button:active{transform: translateY(1px)}
    .note{
      color:var(--muted);
      font-size:13px;
      padding:10px 12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      border-radius:12px;
      flex:1;
      min-width:260px;
    }

    .card{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius:16px;
      box-shadow: var(--shadow);
      padding:16px;
      max-width:900px;
      margin: 0 auto;
    }

    .bannerWrap{
      max-width:900px;
      margin: 14px auto 0;
      display:flex;
      justify-content:center;
    }
    .banner{
      width: 100%;
      max-width: 900px;
      border-radius:16px;
      border:1px solid var(--border);
      box-shadow: var(--shadow);
      overflow:hidden;
      background: rgba(255,255,255,.02);
    }
    .banner img{display:block;width:100%;height:auto}

    .qhead{
      display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap;
      margin-bottom:12px;
    }
    .qnum{
      font-weight:900;color:var(--accent);
      background: rgba(122,167,255,.10);
      border:1px solid rgba(122,167,255,.20);
      padding:6px 10px;border-radius:999px;
      white-space:nowrap;
    }
    .qtext{margin:0;font-size:18px;line-height:1.35;flex:1;min-width:260px}
    .qmeta{
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
      padding:6px 10px;border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
    }
    .opts{display:grid;gap:10px;margin-top:10px}
    .opt{
      text-align:left;
      padding:14px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(15,23,48,.45);
      color:var(--text);
      font-weight:800;
      transition: transform .05s ease, background .15s ease, border-color .15s ease, opacity .15s ease;
      user-select:none;
    }
    .opt:hover{border-color: rgba(122,167,255,.35)}
    .opt:active{transform: translateY(1px)}
    .opt.correct{background: rgba(39,209,124,.18);border-color: rgba(39,209,124,.55)}
    .opt.wrong{background: rgba(255,77,77,.16);border-color: rgba(255,77,77,.55)}
    .opt.locked{opacity:.85;cursor:not-allowed}

    .foot{
      margin-top:12px;
      color:var(--muted);
      font-size:12px;
      display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;
    }
    .badge{
      padding:6px 10px;border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      white-space:nowrap;
    }

    .fadeOut{opacity:0; transform: translateY(6px); transition: opacity .22s ease, transform .22s ease;}
    .fadeIn{opacity:1; transform: translateY(0); transition: opacity .22s ease, transform .22s ease;}

    .endTitle{font-size:22px;margin:0 0 10px 0}
    .endText{color:var(--muted);margin:0 0 14px 0;line-height:1.45}
    .endGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width:720px){ .endGrid{grid-template-columns:1fr 1fr;} }
    .endStat{
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      border-radius:14px;
      padding:12px;
    }
    .endLabel{color:var(--muted);font-size:12px;margin-bottom:6px}
    .endValue{font-weight:900;font-size:22px}
    .signature{
      margin-top:14px;
      padding:10px 12px;
      border-radius:14px;
      border:1px dashed rgba(255,255,255,.18);
      background: rgba(255,255,255,.02);
      color: var(--text);
      font-weight:800;
    }
    .smallDisclaimer{
      margin-top:10px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="madeby">Made by ryxii</div>

        <div class="titleblock">
          <h1>WAVEBOYS QUIZ</h1>
          <div class="subtitle">Nur 1 Frage gleichzeitig: beantworten → nächste kommt automatisch.</div>
        </div>

        <div class="stats">
          <div class="pill"><span class="dot good"></span> Richtig: <span id="correctQ">0</span></div>
          <div class="pill"><span class="dot bad"></span> Falsch: <span id="wrongQ">0</span></div>
          <div class="pill"><span class="dot rem"></span> Übrig: <span id="remainingQ">85</span></div>
          <div class="bar" aria-label="Fortschritt">
            <div class="seg good" id="segGood" style="width:0%"></div>
            <div class="seg bad"  id="segBad"  style="width:0%"></div>
            <div class="seg rem"  id="segRem"  style="width:100%"></div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div class="controls">
        <div class="note">
          <b>Hinweis:</b> Bei Mehrfachauswahl steht in der Frage, wie viele Antworten richtig sind.
          Du klickst genau so viele Optionen – danach geht’s automatisch weiter.
        </div>
        <button id="resetBtn" type="button">Reset</button>
      </div>

      <div id="stage" class="fadeIn"></div>

      <div class="bannerWrap" aria-label="Banner">
        <div class="banner">
          <img alt="Banner" src="data:image/png;base64,HIER_DEIN_BASE64_BANNER_EINFÜGEN" />
        </div>
      </div>
    </div>
  </main>

  <script>
    // ✅ NEU: Wie lange Grün/Rot sichtbar bleibt (1–2 Sekunden)
    const RESULT_DELAY_MS = 700; // 1600ms = 1,6s (du kannst 1200–2000 machen)

    // ✅ NEU: Fisher-Yates Shuffle
    function shuffleArray(arr){
      for (let i = arr.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // ======= 85 Fragen: Geographie (20) + Historie (20) + Allgemeinwissen (38) + Mathe (7) =======
    // (Hier angepasst: Mathe schwerer + 18 Zusatz-Allgemeinwissen keeps schwerer)

    const QUESTIONS = [
      // ===== GEOGRAPHIE (20) =====
      { q: "Was ist die Hauptstadt von Kanada?", options: ["Toronto","Ottawa","Montreal","Vancouver"], correct: [1] },
      { q: "Was ist die Hauptstadt von Australien?", options: ["Sydney","Melbourne","Canberra","Perth"], correct: [2] },
      { q: "Was ist die Hauptstadt von Brasilien?", options: ["Rio de Janeiro","São Paulo","Brasília","Salvador"], correct: [2] },
      { q: "Was ist die Hauptstadt der Türkei?", options: ["Istanbul","Ankara","Izmir","Bursa"], correct: [1] },
      { q: "Was ist die Hauptstadt von Südafrika (Regierungssitz)?", options: ["Kapstadt","Johannesburg","Pretoria","Durban"], correct: [2] },
      { q: "Welche Stadt ist Hauptstadt der Schweiz?", options: ["Zürich","Bern","Genf","Basel"], correct: [1] },
      { q: "Welche Stadt ist Hauptstadt der Niederlande?", options: ["Den Haag","Amsterdam","Rotterdam","Utrecht"], correct: [1] },
      { q: "Welche Stadt ist Hauptstadt von Neuseeland?", options: ["Auckland","Wellington","Christchurch","Hamilton"], correct: [1] },
      { q: "Welche Stadt ist Hauptstadt von Indien?", options: ["Mumbai","Neu-Delhi","Bengaluru","Kolkata"], correct: [1] },
      { q: "Welche Stadt ist Hauptstadt von Japan?", options: ["Osaka","Kyoto","Tokio","Nagoya"], correct: [2] },
      { q: "Welcher Fluss fließt durch Paris?", options: ["Seine","Rhone","Loire","Garonne"], correct: [0] },
      { q: "Welcher Fluss fließt durch Rom?", options: ["Po","Tiber","Arno","Etsch"], correct: [1] },
      { q: "Welcher Ozean liegt östlich von Afrika?", options: ["Atlantik","Indischer Ozean","Pazifik","Arktischer Ozean"], correct: [1] },
      { q: "In welchem Land liegt die Stadt Marrakesch?", options: ["Tunesien","Marokko","Algerien","Ägypten"], correct: [1] },
      { q: "Welche Gebirgskette trennt Spanien und Frankreich?", options: ["Alpen","Pyrenäen","Karpaten","Apennin"], correct: [1] },
      { q: "Wie heißt der höchste Berg Europas (nach gängiger Elbrus-Definition)?", options: ["Mont Blanc","Elbrus","Matterhorn","Dufourspitze"], correct: [1] },
      { q: "Welche Insel ist flächenmäßig die größte der Welt?", options: ["Grönland","Borneo","Madagaskar","Neuguinea"], correct: [0] },
      { q: "Welche Stadt ist Hauptstadt von Norwegen?", options: ["Bergen","Oslo","Trondheim","Stavanger"], correct: [1] },
      { q: "Welche Stadt ist Hauptstadt von Polen?", options: ["Krakau","Warschau","Danzig","Breslau"], correct: [1] },
      { q: "Welche Stadt ist Hauptstadt von Griechenland?", options: ["Thessaloniki","Athen","Patras","Heraklion"], correct: [1] },

      // ===== HISTORIE (20) =====
      { q: "In welchem Jahr fiel die Berliner Mauer?", options: ["1987","1989","1991","1993"], correct: [1] },
      { q: "Wer war der erste Bundeskanzler der Bundesrepublik Deutschland?", options: ["Willy Brandt","Konrad Adenauer","Helmut Schmidt","Ludwig Erhard"], correct: [1] },
      { q: "Welche antike Stadt wurde im Jahr 79 n. Chr. durch den Vesuv verschüttet?", options: ["Karthago","Pompeji","Athen","Sparta"], correct: [1] },
      { q: "Welche Kultur baute die Pyramiden von Gizeh?", options: ["Römer","Ägypter","Griechen","Perser"], correct: [1] },
      { q: "Wer war der berühmte makedonische Eroberer des Altertums?", options: ["Julius Caesar","Alexander der Große","Hannibal","Augustus"], correct: [1] },
      { q: "In welchem Jahr begann der Erste Weltkrieg?", options: ["1912","1914","1916","1918"], correct: [1] },
      { q: "In welchem Jahr endete der Zweite Weltkrieg in Europa?", options: ["1944","1945","1946","1947"], correct: [1] },
      { q: "Welche Revolution begann 1789?", options: ["Industrielle Revolution","Französische Revolution","Russische Revolution","Amerikanische Revolution"], correct: [1] },
      { q: "Wer war der erste Mensch auf dem Mond?", options: ["Buzz Aldrin","Neil Armstrong","Yuri Gagarin","Michael Collins"], correct: [1] },
      { q: "Welches Reich hatte Konstantinopel als Hauptstadt?", options: ["Römisches Reich","Byzantinisches Reich","Osmanisches Reich","Persisches Reich"], correct: [1] },
      { q: "Welche berühmte Handelsstraße verband Europa und Asien?", options: ["Bernsteinstraße","Seidenstraße","Königsweg","Via Appia"], correct: [1] },
      { q: "Welches Ereignis markiert oft das Ende des Mittelalters (klassisch)?", options: ["Völkerwanderung","Entdeckung Amerikas 1492","Reichsgründung 1871","Wiener Kongress"], correct: [1] },
      { q: "Wer schrieb 'Die Odyssee' (zugeschrieben)?", options: ["Sophokles","Homer","Platon","Aristoteles"], correct: [1] },
      { q: "Mehrfachauswahl: 2 richtig – Welche gehörten zu den Achsenmächten im Zweiten Weltkrieg?", options: ["Deutschland","Italien","Frankreich","Kanada"], correct: [0,1] },
      { q: "Welche Stadt war im Kalten Krieg geteilt?", options: ["München","Berlin","Hamburg","Wien"], correct: [1] },
      { q: "Wer war der erste Präsident der USA?", options: ["Abraham Lincoln","George Washington","Thomas Jefferson","John Adams"], correct: [1] },
      { q: "Die 'Magna Carta' wurde in welchem Land unterzeichnet?", options: ["Frankreich","England","Spanien","Italien"], correct: [1] },
      { q: "Welches Reich wurde 1453 erobert (Fall Konstantinopels)?", options: ["Byzantinisches Reich","Römisches Reich","Persisches Reich","Heiliges Römisches Reich"], correct: [0] },
      { q: "Welche Epoche folgte direkt auf die Antike?", options: ["Renaissance","Mittelalter","Aufklärung","Barock"], correct: [1] },
      { q: "Welche deutsche Stadt war lange Regierungssitz der BRD (vor Berlin)?", options: ["Berlin","Bonn","Frankfurt","Leipzig"], correct: [1] },

      // ===== ALLGEMEINWISSEN (38) =====
      { q: "Wie viele Kontinente gibt es (klassisch)?", options: ["5","6","7","8"], correct: [2] },
      { q: "Welcher Planet ist der Sonne am nächsten?", options: ["Venus","Merkur","Mars","Erde"], correct: [1] },
      { q: "Welches Element hat das chemische Symbol 'O'?", options: ["Gold","Osmium","Sauerstoff","Zinn"], correct: [2] },
      { q: "Welches Tier ist das größte lebende Säugetier?", options: ["Afrikanischer Elefant","Blauwal","Giraffe","Orca"], correct: [1] },
      { q: "Welche Einheit misst elektrische Stromstärke?", options: ["Volt","Ampere","Watt","Ohm"], correct: [1] },
      { q: "Wer schrieb 'Faust'?", options: ["Schiller","Goethe","Kafka","Brecht"], correct: [1] },
      { q: "Welche Sprache hat die meisten Muttersprachler weltweit (typisch gezählt)?", options: ["Englisch","Spanisch","Mandarin-Chinesisch","Hindi"], correct: [2] },
      { q: "Was ist die chemische Formel von Wasser?", options: ["CO2","H2O","O2","NaCl"], correct: [1] },
      { q: "Welche Blutgruppe gilt als Universalspender (vereinfacht, ohne Rhesusfaktor)?", options: ["A","B","AB","0"], correct: [3] },
      { q: "Was ist die härteste natürliche Substanz?", options: ["Quarz","Diamant","Granit","Stahl"], correct: [1] },
      { q: "Welches Organ filtert Blut und produziert Urin?", options: ["Leber","Niere","Lunge","Magen"], correct: [1] },
      { q: "Was bedeutet 'WWW'?", options: ["World Wide Web","Wireless Web World","Wide World Wire","World Web Window"], correct: [0] },
      { q: "Welche Farbe entsteht aus Blau und Gelb?", options: ["Grün","Orange","Lila","Braun"], correct: [0] },
      { q: "Wie viele Grad hat ein rechter Winkel?", options: ["45","90","120","180"], correct: [1] },
      { q: "Welches Land ist bekannt für das Kolosseum?", options: ["Griechenland","Italien","Spanien","Türkei"], correct: [1] },
      { q: "Mehrfachauswahl: 2 richtig – Welche sind Programmiersprachen?", options: ["Python","HTML","Java","CSS"], correct: [0,2] },
      { q: "Was ist ein Synonym für 'präzise'?", options: ["vage","exakt","chaotisch","unklar"], correct: [1] },
      { q: "Welche Währung hat Japan?", options: ["Yuan","Won","Yen","Ringgit"], correct: [2] },
      { q: "Welche Stadt ist Hauptstadt von Frankreich?", options: ["Marseille","Paris","Lyon","Nizza"], correct: [1] },
      { q: "Welche Stadt ist Hauptstadt von Spanien?", options: ["Barcelona","Madrid","Valencia","Sevilla"], correct: [1] },

      { q: "Welcher Staat ist flächenmäßig der größte der Welt?", options: ["Kanada","China","USA","Russland"], correct: [3] },
      { q: "Was ist das chemische Symbol für Natrium?", options: ["Na","N","Nt","Nr"], correct: [0] },
      { q: "Welches Gas ist der Hauptbestandteil der Erdatmosphäre?", options: ["Sauerstoff","Kohlendioxid","Stickstoff","Argon"], correct: [2] },
      { q: "Welche Einheit wird für elektrische Leistung verwendet?", options: ["Volt","Watt","Ampere","Ohm"], correct: [1] },
      { q: "Welcher Knochen ist der längste im menschlichen Körper?", options: ["Schienbein","Oberarmknochen","Oberschenkelknochen","Becken"], correct: [2] },
      { q: "Wie heißt der größte Planet unseres Sonnensystems?", options: ["Saturn","Jupiter","Neptun","Uranus"], correct: [1] },
      { q: "Welches Land gehört NICHT zu den Benelux-Staaten?", options: ["Belgien","Niederlande","Luxemburg","Dänemark"], correct: [3] },
      { q: "Was bedeutet die Abkürzung 'LED'?", options: ["Light Emitting Diode","Long Energy Device","Laser Emitting Display","Light Energy Driver"], correct: [0] },
      { q: "Welche Vitamine werden bei Sonneneinstrahlung in der Haut gebildet?", options: ["Vitamin A","Vitamin C","Vitamin D","Vitamin K"], correct: [2] },
      { q: "Welcher Begriff passt: DNA steht für …", options: ["Desoxyribonukleinsäure","Dynamische Nuklein-Analyse","Doppel-Nitrogen-Acid","Desoxynitro-Amin"], correct: [0] },
      { q: "Welche Stadt gilt als Sitz der EU-Kommission?", options: ["Straßburg","Brüssel","Luxemburg","Frankfurt"], correct: [1] },
      { q: "Wie nennt man die Lehre von den Sternbildern/Planetenbahnen allgemein?", options: ["Geologie","Astronomie","Biologie","Meteorologie"], correct: [1] },
      { q: "Welche Aussage ist richtig zur Photosynthese?", options: ["Sie verbraucht Sauerstoff und erzeugt CO₂","Sie erzeugt Zucker aus Licht, CO₂ und Wasser","Sie findet nur nachts statt","Sie passiert nur bei Tieren"], correct: [1] },
      { q: "Mehrfachauswahl: 2 richtig – Welche zählen zu erneuerbaren Energien?", options: ["Windkraft","Erdöl","Solarenergie","Kohle"], correct: [0,2] },
      { q: "Welcher Kontinent hat die meisten Länder?", options: ["Europa","Afrika","Asien","Südamerika"], correct: [1] },
      { q: "Was bezeichnet man als 'pH-Wert' am ehesten?", options: ["Temperatur einer Lösung","Säuregrad einer Lösung","Druck in einem Gefäß","Lichtstärke"], correct: [1] },
      { q: "Welche Einheit entspricht 1 Newton?", options: ["kg·m/s²","kg/s","m/s²","N ist dimensionslos"], correct: [0] },
      { q: "Welche Aussage trifft auf 'Inflation' am ehesten zu?", options: ["Allgemeines Sinken der Preise","Allgemeines Steigen des Preisniveaus","Mehr Exporte als Importe","Sinkender Leitzins"], correct: [1] },

      // ===== MATHE (7) – jetzt SCHWIERIGER =====
      { q: "Rechnung: 15% von 240 = ?", options: ["24","30","36","48"], correct: [2] },
      { q: "Rechnung: (48 ÷ 6) × (14 − 9) = ?", options: ["30","35","40","45"], correct: [3] },
      { q: "Rechnung: 7,5 × 1,2 = ?", options: ["8,4","8,7","9,0","9,2"], correct: [2] },
      { q: "Rechnung: 3/5 von 250 = ?", options: ["120","140","150","160"], correct: [2] },
      { q: "Rechnung: (1200 ÷ 3) ÷ 8 = ?", options: ["40","50","60","70"], correct: [1] },
      { q: "Rechnung: Eine Strecke ist 180 km. Bei 90 km/h – wie lange?", options: ["1 h","1 h 30 min","2 h","2 h 30 min"], correct: [2] },
      { q: "Welche Zahl setzt die Reihe fort: 3, 6, 12, 24, ...", options: ["30","36","42","48"], correct: [3] },
    ];

    // UI refs
    const stage = document.getElementById("stage");
    const correctQEl = document.getElementById("correctQ");
    const wrongQEl = document.getElementById("wrongQ");
    const remainingQEl = document.getElementById("remainingQ");
    const segGood = document.getElementById("segGood");
    const segBad  = document.getElementById("segBad");
    const segRem  = document.getElementById("segRem");

    // State
    let correctQuestions = 0;
    let wrongQuestions = 0;
    let currentIndex = 0;
    let busy = false;

    // ✅ NEU: pro Frage merken wir uns die gemischte Reihenfolge + korrekte Indizes nach Shuffle
    const perQ = QUESTIONS.map(q => ({
      locked:false,
      picks:[],
      required:q.correct.length,
      order:null,          // Array der originalen Indizes in gemischter Reihenfolge
      correctShuffled:null // Array der richtigen Indizes NACH Shuffle
    }));

    function updateTop(){
      correctQEl.textContent = String(correctQuestions);
      wrongQEl.textContent = String(wrongQuestions);

      const answered = correctQuestions + wrongQuestions;
      const remaining = QUESTIONS.length - answered;
      remainingQEl.textContent = String(remaining);

      const total = QUESTIONS.length;
      const goodPct = (correctQuestions / total) * 100;
      const badPct  = (wrongQuestions / total) * 100;
      const remPct  = 100 - goodPct - badPct;

      segGood.style.width = goodPct + "%";
      segBad.style.width  = badPct + "%";
      segRem.style.width  = remPct + "%";
    }

    function renderCurrent(){
      stage.innerHTML = "";
      stage.classList.remove("fadeOut");
      stage.classList.add("fadeIn");

      if (currentIndex >= QUESTIONS.length){
        renderEndScreen();
        updateTop();
        return;
      }

      const item = QUESTIONS[currentIndex];
      const st = perQ[currentIndex];

      // ✅ NEU: Antworten mischen (dadurch ist nicht immer (1) richtig)
      const order = shuffleArray([...Array(item.options.length).keys()]);
      st.order = order;

      // ✅ NEU: correct auf neue Positionen umrechnen
      st.correctShuffled = [];
      for (let newIdx = 0; newIdx < order.length; newIdx++){
        const originalIdx = order[newIdx];
        if (item.correct.includes(originalIdx)) st.correctShuffled.push(newIdx);
      }

      const card = document.createElement("div");
      card.className = "card";

      const qhead = document.createElement("div");
      qhead.className = "qhead";

      const qnum = document.createElement("div");
      qnum.className = "qnum";
      qnum.textContent = `Frage ${currentIndex+1}/${QUESTIONS.length}`;

      const qtext = document.createElement("p");
      qtext.className = "qtext";
      qtext.textContent = item.q;

      const meta = document.createElement("div");
      meta.className = "qmeta";
      meta.textContent = item.correct.length > 1
        ? `Mehrfachauswahl: ${item.correct.length} richtig`
        : "Einfachauswahl: 1 richtig";

      qhead.appendChild(qnum);
      qhead.appendChild(qtext);
      qhead.appendChild(meta);

      const opts = document.createElement("div");
      opts.className = "opts";

      // ✅ NEU: gerenderte Optionen nutzen die gemischte Reihenfolge
      order.forEach((originalIdx, newIdx) => {
        const t = item.options[originalIdx];
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "opt";
        btn.textContent = t;
        btn.addEventListener("click", () => handlePick(newIdx, btn, opts)); // newIdx ist jetzt Klick-Index
        opts.appendChild(btn);
      });

      const foot = document.createElement("div");
      foot.className = "foot";

      const b1 = document.createElement("div");
      b1.className = "badge";
      b1.textContent = `Richtige Antworten: ${item.correct.length}`;

      const b2 = document.createElement("div");
      b2.className = "badge";
      b2.textContent = `Ausgewählt: ${st.picks.length}/${st.required}`;

      foot.appendChild(b1);
      foot.appendChild(b2);

      card.appendChild(qhead);
      card.appendChild(opts);
      card.appendChild(foot);

      stage.appendChild(card);
      updateTop();
    }

    function lockButtons(optsDiv){
      [...optsDiv.querySelectorAll(".opt")].forEach(b => b.classList.add("locked"));
    }

    function evaluateAndNext(optsDiv){
      const item = QUESTIONS[currentIndex];
      const st = perQ[currentIndex];

      // ✅ NEU: evaluate gegen gemischte correct indices
      const correctNow = st.correctShuffled || item.correct;

      const picksSorted = [...st.picks].sort((a,b)=>a-b).join(",");
      const corrSorted  = [...correctNow].sort((a,b)=>a-b).join(",");
      const exactMatch = (picksSorted === corrSorted);

      if (exactMatch) correctQuestions += 1;
      else wrongQuestions += 1;

      st.locked = true;
      lockButtons(optsDiv);
      updateTop();

      busy = true;

      // ✅ NEU: Ergebnis 1–2 Sekunden stehen lassen, dann erst weiter
      setTimeout(() => {
        stage.classList.remove("fadeIn");
        stage.classList.add("fadeOut");

        setTimeout(() => {
          currentIndex += 1;
          busy = false;
          renderCurrent();
        }, 250); // Fade-Out Zeit
      }, RESULT_DELAY_MS);
    }

    function handlePick(optIndex, btnEl, optsDiv){
      if (busy) return;

      const item = QUESTIONS[currentIndex];
      const st = perQ[currentIndex];
      if (st.locked) return;
      if (st.picks.includes(optIndex)) return;

      st.picks.push(optIndex);

      // ✅ NEU: korrekt gegen gemischte correct indices prüfen
      const correctNow = st.correctShuffled || item.correct;

      const isCorrectNow = correctNow.includes(optIndex);
      if (isCorrectNow) btnEl.classList.add("correct");
      else btnEl.classList.add("wrong");

      const badges = stage.querySelectorAll(".badge");
      if (badges && badges[1]) badges[1].textContent = `Ausgewählt: ${st.picks.length}/${st.required}`;

      if (st.picks.length >= st.required){
        evaluateAndNext(optsDiv);
      }
    }

    // ======= IQ Umrechnung (Spaß / nicht wissenschaftlich) =======
    function estimateIQFromResults(correctQ, wrongQ){
      const total = correctQ + wrongQ;
      if (total <= 0) return 100;

      const accuracy = correctQ / total;
      const errorRate = wrongQ / total;

      let iq = 100 + (accuracy - 0.5) * 85;
      iq -= Math.pow(errorRate, 1.45) * 38;

      iq = Math.round(iq);
      iq = Math.max(70, Math.min(140, iq));
      return iq;
    }

    function renderEndScreen(){
      const total = QUESTIONS.length;
      const rate = total > 0 ? Math.round((correctQuestions / total) * 100) : 0;
      const iqGuess = estimateIQFromResults(correctQuestions, wrongQuestions);

      const card = document.createElement("div");
      card.className = "card";

      const head = document.createElement("div");
      head.className = "qhead";

      const qnum = document.createElement("div");
      qnum.className = "qnum";
      qnum.textContent = `Fertig (${total} Fragen)`;

      const title = document.createElement("p");
      title.className = "qtext";
      title.innerHTML = "<b>Du hast das Quiz erfolgreich beendet.</b>";

      const meta = document.createElement("div");
      meta.className = "qmeta";
      meta.textContent = "Übersicht";

      head.appendChild(qnum);
      head.appendChild(title);
      head.appendChild(meta);

      const h2 = document.createElement("h2");
      h2.className = "endTitle";
      h2.textContent = "Ergebnis";

      const p = document.createElement("p");
      p.className = "endText";
      p.textContent = "Richtig / Falsch + Bonus: eine (spaßige) IQ-Umrechnung.";

      const grid = document.createElement("div");
      grid.className = "endGrid";

      const c1 = document.createElement("div");
      c1.className = "endStat";
      c1.innerHTML = `<div class="endLabel">Richtig</div><div class="endValue" style="color:var(--good)">${correctQuestions}</div>`;

      const c2 = document.createElement("div");
      c2.className = "endStat";
      c2.innerHTML = `<div class="endLabel">Falsch</div><div class="endValue" style="color:var(--bad)">${wrongQuestions}</div>`;

      const c3 = document.createElement("div");
      c3.className = "endStat";
      c3.innerHTML = `<div class="endLabel">Trefferquote</div><div class="endValue">${rate}%</div>`;

      const c4 = document.createElement("div");
      c4.className = "endStat";
      c4.innerHTML = `<div class="endLabel">IQ (umgerechnet)</div><div class="endValue">${iqGuess}</div>`;

      grid.appendChild(c1);
      grid.appendChild(c2);
      grid.appendChild(c3);
      grid.appendChild(c4);

      const disclaimer = document.createElement("div");
      disclaimer.className = "smallDisclaimer";
      disclaimer.textContent =
        "Hinweis: Diese IQ-Zahl ist nur ein Spaß-Wert (aus der Trefferquote abgeleitet) und kein echter IQ-Test.";

      const sig = document.createElement("div");
      sig.className = "signature";
      sig.textContent = "Lg ryxii";

      const actions = document.createElement("div");
      actions.className = "actions";
      actions.style.marginTop = "14px";
      actions.style.justifyContent = "flex-end";

      const restart = document.createElement("button");
      restart.textContent = "Nochmal spielen";
      restart.addEventListener("click", resetAll);

      actions.appendChild(restart);

      card.appendChild(head);
      card.appendChild(h2);
      card.appendChild(p);
      card.appendChild(grid);
      card.appendChild(disclaimer);
      card.appendChild(sig);
      card.appendChild(actions);

      stage.appendChild(card);

      remainingQEl.textContent = "0";
      updateTop();
    }

    function resetAll(){
      correctQuestions = 0;
      wrongQuestions = 0;
      currentIndex = 0;
      busy = false;

      for (const st of perQ){
        st.locked = false;
        st.picks = [];
        st.order = null;
        st.correctShuffled = null;
      }
      renderCurrent();
      updateTop();
      window.scrollTo({top:0, behavior:"smooth"});
    }

    document.getElementById("resetBtn").addEventListener("click", resetAll);

    renderCurrent();
    updateTop();
  </script>
</body>
</html>
